<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>쫄작 계산기</title>
  <style>
    @font-face {
    font-family: 'Gyeonggi_Title_Medium';
    src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2410-3@1.0/Title_Medium.woff') format('woff');
    font-weight: 300;
    font-style: normal;
}

    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      padding : 15px;
      margin-left: auto;
      margin-right: auto;
    }

    label, h3, h4, h1, select, input[type="checkbox"] {
      -webkit-user-select: none; /* Safari */
      -moz-user-select: none;    /* Firefox */
      -ms-user-select: none;     /* IE/Edge */
      user-select: none;         /* 표준 */
    }

    h1, h3, h4 {
      font-family: 'Gyeonggi_Title_Medium';
      color: #333;
    }

    .section {
      margin-bottom: 10px;
    }

    label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 8px 0;
    }

    label[for="checkboxlabel"] {
      cursor: pointer;
    }

    input[type="number"],
    select {
      flex: 1;
      padding: 6px;
      margin-left: 10px;
      cursor: pointer;
    }
    
    input[type="number"] {
      cursor:text;
    }

    input[type="checkbox"] {
      margin-right: 10px;
      cursor: pointer;
    }

    button {
      font-family: 'Gyeonggi_Title_Medium';
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    .resetbutton {
      background-color: #ccc; 
      color: #333;
    }
    
    .resetbutton:hover {
      background-color: #b4b4b4; 
    }

    .checkbox-row {
      display: flex;
      flex-wrap: nowrap;
      gap: 20px;
      flex-direction: row;
    }

    .overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  display: none;
  justify-content: center;
  align-items: center;
  animation: fadeOut 0.2s ease forwards;
  z-index: 1000;
}

.overlay.show {
  display: flex;
  animation: fadeIn 0.2s ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}
@keyframes fadeOut {
  from { opacity: 1; }
  to   { opacity: 0; }
}

.assumption-box {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  position: relative;
  animation: fadeIn 0.2s ease forwards;
}

.assumption-box h3 {
  margin-top: 0;
}

.assumption-box ul {
  padding-left: 20px;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 20px;
  cursor: pointer;
}

.title-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: nowrap;
  gap: 10px;
  padding: 15px 60px;
  white-space: nowrap;
  overflow: hidden;
}

.title-wrapper h1 {
  font-size: clamp(38px, 5vw, 40px); /* 화면 크기에 따라 자동 조절 */
  margin-bottom: 10px;
  flex-shrink: 1;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.assumption-button {
  background-color: #777;
  transition: background-color 0.15s ease-in-out;
  font-size: 14px;
  padding: 7px 10px;
  white-space: nowrap;
  max-width: 120px;
  min-width: 80px;
  width: auto;
  flex-shrink: 0;
  margin-top: 10px;
}



.assumption-box .credit {
  position: absolute;
  bottom: 10px;
  right: 10px;
  font-size: 13px;
  color: #999;
}

.assumption-button:hover {
      background-color: #e06040;
    }

    .checkbox-label {
      cursor: pointer;
    }

    #raidOver11Level {
      margin-left: 15px;
    }
    .button-column {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
  align-items: flex-start; /* 왼쪽 정렬 (원하면 center로 변경 가능) */
}

/* 입력 상자를 감싸는 컨테이너를 기본적으로 숨김 */
        #keyBoxCount_container {
            display: none;
            margin-left: 10px;
        }

        #premiumOption {
    display: none;
  }

  #openSubModal, #openSenaPassModal, #openRubyToUseModal {
    cursor: pointer;
    color: #333;
    transition: color 0.15s ease-in-out;
  }

  #openSubModal:hover, #openSenaPassModal:hover, #openRubyToUseModal:hover {
    cursor: pointer;
    color:#e06040
  }

.mobile-break {
  display: inline;
}
.mobile-br {
    display: none;
  }

    @media (max-width: 480px) {
      .rubyuse {
        line-height: 24px;
      }

      label {
        flex-direction: nowrap;
        align-items: center;
        vertical-align: middle;
      }

      input[type="number"],
      select {
        margin-left: 5px;
        width: 100%;
        margin-top: 5px;
      }

      button {
        width: 100%;
      }

      .title-wrapper {
        padding: 8px 25px;
        line-height: 40px;
        margin-left: 8%;
        margin-top: -2%;
        letter-spacing: 0.25em;
      }
      .checkbox-row {
        flex-direction: nowrap; /* 세로 배열로 전환 */
        gap: 10px;
      }
      .mobile-break {
    display: none;
  }
  .mobile-br {
    display: inline;
  }
    }
  </style>
</head>
<body>

  <div class="title-wrapper">
    <h1>세나리 <span class="mobile-break">쫄작</span> <span class="mobile-br"><br></span> 계산기</h1>
    <div class="button-column">
      <button id="showAssumption" class="assumption-button">전제조건</button>
      <button id="showIncludedItems" class="assumption-button">계산 포함 항목</button>
    </div>
  </div>

  <div id="assumptionOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn">&times;</span>
      <h3>📌 계산 전제조건</h3>
      <ul>
        <li>쫄작은 모험 일반 14영지 이상, 전복률 0% 기준</li>
        <li>열쇠를 최대 보유개수 이상 방치하지 않고 계속 사용</li>
        <li>일일 의뢰, 세나패스 등 일일 퀘스트는 모두 진행</li>
        <li>길드 출석 보상 열쇠 60개</li>
        <li>상점 무료상품 모두 구매</li>
      </ul>
      <h3>📌 유의사항</h3>
      <ul>
        <li>각 카테고리(굵은 글씨)를 클릭하면 해당값을 볼 수 있음</li>
        <li>쫄작원정대 열쇠는 쫄작원정대Ⅱ 마지막 사이클 기준</li>
        <li>총력전 루비 보상은 2주에 한번씩 받는 걸로 계산</li>
        <li>세나패스는 풀참시 12일이면 모든 보상을 받을 수 있으므로, 
          2주와 4주 순이익에 세나패스가 미치는 영향이 서로 같도록 처리함. 그래서 2주 동안의 순이익이 4주 동안의 순이익보다 일평균 순이익이 높음
        </li>
        <li>잡화상점, 총력전 출석, 이벤트 보상 등의 다른 변수는 계산에 포함하지 않았으므로 계산 전제조건을 만족한다면 실제 모을 수 있는 루비는 계산결과 보다 많음</li>
        <li>모든 계산 결과는 대략적인 수치로 100% 정확하지 않음 (± 80루비 범위 오차)</li>
      </ul><div class="credit">Made by 182.210</div>
    </div>
  </div>

  <div id="includedItemsOverlay" class="overlay">
  <div class="assumption-box">
    <span class="close-btn" onclick="closeIncludedItems()">&times;</span>
    <h3>🗝️ 계산에 기본 포함된 열쇠</h3>
    <ul>
      <li>자동 충전 열쇠(1일) : 480개(기본) / 720개(월정액)</li>
      <li>일일의뢰 + 길드출석(1일) : 120개</li>
      <li>300일 출석표(10일) : 240개. 1일에 24개로 계산</li>
      <li>주말 푸시보상(1주) : 200개</li>
      <li>상점 무료 열쇠상자(1일) : 60개</li>
    </ul>
    <h3>♦️ 계산에 기본 포함된 루비</h3>
    <ul>
      <li>일일의뢰 + 상점 무료루비(1일) : 130개</li>
      <li>300일 출석표(10일) : 200개. 1일에 20개로 계산</li>
      <li>주말 부스트 보상(1주) : 100개</li>
    </ul>
    <div class="credit">Made by 182.210</div>
  </div>
</div>

  <div class="section" style="display: flex; gap: 20px;">
    <h3 id="openSubModal">월정액 여부</h3>
    <div class="checkbox-row">
        <label class="checkbox-label"><input type="checkbox" id="rubySubscription" > 루비 월정액</label>
        <label class="checkbox-label"><input type="checkbox" id="keySubscription" > 열쇠 월정액</label>
    </div>
  </div>

    <div id="MonthlySubOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn" onclick="closeSubModal()">&times;</span>
      <h3>♦️ 루비 월정액 구매 시</h3>
      <ul>
        <li>매일 출석 루비 200개</li>
        <li>월정액 구매 보너스 루비 330개 (4주 당 한번)</li>
        <li>모험 경험치 보너스 10% (쫄작 판수 1판 감소)</li>
      </ul>
      <h3>🗝️ 열쇠 월정액 구매 시</h3>
      <ul>
        <li>매일 출석 열쇠 80개</li>
        <li>월정액 구매 보너스 루비 200개 (4주 당 한번)</li>
        <li>자동 충전 열쇠 720개 (24시간 기준)</li>
      </ul>
      </ul><div class="credit">Made by 182.210</div>
    </div>
  </div>

  <div class="section" style="display: flex; gap: 20px; align-items: center;">
    <h3 id="openSenaPassModal">세나패스</h3>
    <label class="checkbox-label"><input type="checkbox" id="senaPass" > 세나패스 포함</label>
    <span id="premiumOption">
      <label class="checkbox-label"><input type="checkbox" id="senaPass_premium" > 프리미엄 구매</label>
    </span>
  </div>

  <div id="SenaPassOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn" onclick="closeSenaPassModal()">&times;</span>
      <h3>기본 세나패스 풀참 시</h3>
      <ul>
        <li>열쇠 총 480개</li>
        <li>루비 총 500개</li>
      </ul>
      <h3>프리미엄 패스 구매 시</h3>
      <ul>
        <li>기본 보상 포함 열쇠 총 1080개</li>
        <li>기본 보상 포함 루비 총 2900개</li>
      </ul>
      </ul><div class="credit">Made by 182.210</div>
    </div>
  </div>

  <div class="section" style="display: flex; gap: 15px;">
    <h3>열쇠상자 구매</h3>
    <label for="keyBoxRuby">
      <select id="keyBoxRuby">
        <option value="0">구매 안함</option>
        <option value="50">50루비단</option>
        <option value="80">80루비단</option>
        <option value="100">100루비단</option>
        <option value="120">120루비단</option>
      </select>
      <span id="keyBoxCount_container">
            <input type="number" id="keyBoxCount" min="0" max="50" placeholder="기본:50">
    </span>
    </label>
  </div>

  <div class="section">
    <h3>일주일 동안 상점에서 구매할 열쇠 개수</h3>
    <label for="arenaKeyCount">
      결투장상점 구매 횟수:
      <input type="number" id="arenaKeyCount" min="0" max="7" placeholder="최대 7, 미 입력 시 0">
    </label>

    <label for="honorKeyCount">
      명예상점 구매 횟수:
      <input type="number" id="honorKeyCount" min="0" max="7" placeholder="최대 7, 미 입력 시 0">
    </label>

    <label for="guildKeyCount">
      길드상점 구매 횟수:
      <input type="number" id="guildKeyCount" min="0" max="7" placeholder="최대 7, 미 입력 시 0">
    </label>
  </div>

  <div class="section">
    <div style="display: flex; align-items: center; gap: 10px;">
      <h3>하루 레이드 판 수</h3>
      <span id="raidWarning" style="color: red; font-size: 14px; display: none;">
        레이드 판 수가 너무 많습니다.
      </span>
    </div>
    <label for="raidCount">
      레이드 판 수:
      <input type="number" id="raidCount" min="0" placeholder="예: 10, 미 입력 시 0">
      <label class="checkbox-label"><input type="checkbox" id="raidOver11Level" > 11단계 이상</label>
    </label>
  </div>

  <div class="section">
    <h3>총력전 티어</h3>
    <label for="conquestTier">
      티어 선택:
      <select id="conquestTier">
        <option value="none">선택 안함</option>
        <option value="common">일반</option>
        <option value="advanced">고급</option>
        <option value="rare">희귀</option>
        <option value="legend">전설</option>
      </select>
    </label>
  </div>

<div class="section" style="display: flex; gap: 20px;">
  <h3>쫄작원정대 열쇠 포함</h3>
  <label class="checkbox-label"><input type="checkbox" id="includeExpeditionKey" checked> 포함하여 계산</label>
</div>

<div class="section" style="display: flex; gap: 7px;">
  <h3 id="openRubyToUseModal" class="rubyuse">매일 일정하게 <span class="mobile-br"><br></span>사용할 루비</h3>
  <label for="rubyToUse">
      <input type="number" id="rubyToUse" min="0" placeholder="미 입력 시 0">
    </label>
</div>

<div id="rubyToUseOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn" onclick="closeRubyToUseModal()">&times;</span>
      <h3>♟️ 세나체스 회당 루비 비용</h3>
      <ul>
        <li>2회차 : 50루비</li>
        <li>3회차 : 100루비</li>
        <li>4회차 이상 : 150루비</li>
      </ul>
      <h3>🎫 성장던전 티켓 구매비용</h3>
      <ul>
        <li>1번째 : 100루비</li>
        <li>2번째 : 150루비</li>
        <li>3번째 : 200루비</li>
        <li>4번째 : 300루비</li>
        <li>5번째 이상 : 500루비</li>
      </ul>
      </ul><div class="credit">Made by 182.210</div>
    </div>
  </div>

  <div class="section">
    <button onclick="calculateProfit()">💰 루비 순이익 계산하기</button>
    <button onclick="resetForm()" class="resetbutton">🔄 초기화</button>
    <h3>📆 2주간 루비 순이익: <span id="profit2w">0</span> 루비</h3>
    <h3>📆 4주간 루비 순이익: <span id="profit4w">0</span> 루비</h3>
    <h3>♦️ (2주 기준)일평균 루비 순이익: <span id="avgProfit">0</span> 루비</h3>
    <h4>👥 2주간 만렙찍는 쫄 수: <span id="heroCount">0</span> 마리</h3>
    <h4>📊 하루 평균 만렙찍는 쫄 수: <span id="avgHeroCount">0</span> 마리</h3>
    <h4>💍 악몽 전설 장신구 천장 소요 기간 : <span id="accessoryDays">0</span> 일</h3>
  </div>
<script>

  function resetForm() {
  
    //경고문 초기화
  document.getElementById("raidWarning").style.display = "none";
  document.getElementById("keyBoxCount_container").style.display = "none";

  // 체크박스 초기화
  document.getElementById("rubySubscription").checked = false;
  document.getElementById("keySubscription").checked = false;
  document.getElementById("senaPass").checked = false;
  document.getElementById("senaPass_premium").checked = false;
  document.getElementById("raidOver11Level").checked = false;
  document.getElementById("includeExpeditionKey").checked = true;

  // 셀렉트 초기화
  document.getElementById("keyBoxRuby").value = "0";
  document.getElementById("conquestTier").value = "none";

  // 숫자 입력 초기화
  document.getElementById("honorKeyCount").value = "";
  document.getElementById("guildKeyCount").value = "";
  document.getElementById("arenaKeyCount").value = "";
  document.getElementById("raidCount").value = "";
  document.getElementById("keyBoxCount").value = "";
  document.getElementById("rubyToUse").value = "";

  // 결과창 초기화
  document.getElementById("profit2w").innerText = "0";
  document.getElementById("profit4w").innerText = "0";
  document.getElementById("avgProfit").innerText = "0";
  document.getElementById("heroCount").innerText = "0";
  document.getElementById("avgHeroCount").innerText = "0";
  document.getElementById("accessoryDays").innerText = "0";
}

function calculateProfit() {
  const playsForLegendAccessory = 15000;
  const rubySub = document.getElementById("rubySubscription").checked;
  const keySub = document.getElementById("keySubscription").checked;
  const senaPass = document.getElementById("senaPass").checked;
  const senaPassPremium = document.getElementById("senaPass_premium").checked;
  const raid11Lev = document.getElementById("raidOver11Level").checked;
  const honorCount = parseInt(document.getElementById("honorKeyCount").value) || 0;
  const guildCount = parseInt(document.getElementById("guildKeyCount").value) || 0;
  const arenaCount = parseInt(document.getElementById("arenaKeyCount").value) || 0;
  const keyBoxRuby = parseInt(document.getElementById("keyBoxRuby").value) || 0;
  const parsedBoxCount = parseInt(document.getElementById("keyBoxCount").value);
  const keyBoxCount = isNaN(parsedBoxCount) ? 50 : parsedBoxCount;
  const raidCountPerDay = parseInt(document.getElementById("raidCount").value) || 0;
  const conquestTier = document.getElementById("conquestTier").value;
  const includeExpeditionKey = document.getElementById("includeExpeditionKey").checked;
  const rubyToUse = parseInt(document.getElementById("rubyToUse").value) || 0;

  function getKeyBoxRubyCostPerDay(rubyTier, boxCount) {
    let cost = 0;
    if (rubyTier >= 50) cost += 50 * 20;
    if (rubyTier >= 80) cost += 80 * 50;
    if (rubyTier >= 100) cost += 100 * 50;
    if (rubyTier >= 120) cost += 120 * 50;
    cost -= rubyTier*(50-boxCount);
    return cost;
  }

  function getConquestRuby(tier, weeks) {
    if (weeks < 2) return 0;
    if (tier === "legend") return 6400 * (weeks / 2);
    if (tier === "rare") return 3400 * (weeks / 2);
    if (tier === "advanced") return 1400 * (weeks / 2);
    if (tier === "common") return 200 * (weeks / 2);
    return 0;
  }

 function compute(period) {
  const days = period * 7;
  const weeks = period;

  // 🔹 열쇠 수급
  const naturalKeyPerDay = keySub ? 720 : 480;
  const totalNaturalKeys = naturalKeyPerDay * days;
  const keySubKeys = keySub ? (period === 2 ? 1120 : 2240) : 0;
  const keysFromSenaPass = senaPass ? (senaPassPremium ? 1080 : 480) : 0; // 구매 후 2주안에 끝낸다는 가정 하에(period === 2 ? 540 : 1080) : (period === 2 ? 240 : 480);
  const keysFromDailySources = (60 + 60) * days; // 일일의뢰 + 길드출석
  const keysFrom300Attendance = 24 * days; // 300일 출석표 열쇠. 10일에 240개 이므로 하루에 24개로 계산
  const keysFromShop = (honorCount + guildCount + arenaCount) * 60 * weeks; // 명예 & 길드 상점
  const keysFromWeekend = 200 * weeks; // 주말 푸시 열쇠 (토,일 100개씩)
  const keysFromKeyBox = ((1 + 
    (keyBoxRuby >= 50 ? 20 : 0) +
    (keyBoxRuby >= 80 ? 50 : 0) +
    (keyBoxRuby >= 100 ? 50 : 0) +
    (keyBoxRuby >= 120 ? 50 : 0) - (50-keyBoxCount)) * 60) * days;

  const totalKeysBeforeRaid = totalNaturalKeys + keySubKeys + keysFromSenaPass +
    keysFromDailySources + keysFrom300Attendance + keysFromShop + keysFromWeekend + keysFromKeyBox;

  // 🔹 레이드 차감
  const raidKeysUsed = raid11Lev ? (raidCountPerDay * 12 * days) : (raidCountPerDay * 6 * days) ; // 레이드에 사용되는 열쇠 수. 11단계 이상일 경우 판당 12개 차감
  const keysForCholjak = totalKeysBeforeRaid - raidKeysUsed; // 레이드 열쇠 차감 후 쫄작용 열쇠
  // 레이드 열쇠 소모량이 총 열쇠보다 많을 경우 → 경고 출력
  const raidWarning = document.getElementById("raidWarning");
    if (keysForCholjak < 0) {
      raidWarning.style.display = "inline";
      // return {
      //   netProfit: 0,
      //   heroCount: 0
      // }; // 계산 중단
    } else {
      raidWarning.style.display = "none";
    }

  // 🔹 정확한 쫄작원정대 루프 계산 방식 적용
  const externalRuns = keysForCholjak / 6; // 쫄작원정대 열쇠 이외 열쇠로 쫄작돌리는 횟수
  let totalCholjakKeys = keysForCholjak;
    if (includeExpeditionKey) {
      const choljakQuestKeys = (externalRuns / 2115) * 270; // 2160(쫄작원정대 마지막 사이클 횟수) - 45(쫄작원정대 열쇠로 돌릴 수 있는 횟수) = 2115
      totalCholjakKeys += choljakQuestKeys;

      console.log("원정대 열쇠 보상:", choljakQuestKeys);
    } else {
      console.log("원정대 열쇠 포함하지 않음");
    }

  // 악몽 전설 장신구 천장 소요기간 계산
  let accessoryDays = playsForLegendAccessory / ((totalCholjakKeys / 12) / days);

  // 🔹 쫄작 루비 수익
  const keysPerRun = rubySub ? 60 : 66;
  const runs = totalCholjakKeys / keysPerRun;
  const heroCount = runs * 4;
  const rubyFromCholjak = runs * 80;

  // 🔹 기타 루비 수급
  const rubyFromRubySub = rubySub ? (days * 200 + (period === 2 ? 165 : 330)) : 0;
  const rubyFromKeySubBonus = keySub ? (period === 2 ? 100 : 200) : 0;
  const rubyFromSenaPass = senaPass ? (senaPassPremium ? 2900 : 500) : 0; // (period === 2 ? 1450 : 2900) : (period === 2 ? 250 : 500);
  const rubyFromDailyQuest = 100 * days;
  const rubyFrom300Attendance = 20 * days; // 300일 출석표 루비. 10일에 200개 이므로 하루에 20개로 계산
  const rubyFromFreeShop = 30 * days;
  const rubyFromWeekend = 100 * weeks;
  const rubyFromConquest = getConquestRuby(conquestTier, weeks);

  const totalRubyIncome = rubyFromCholjak + rubyFromRubySub + rubyFromKeySubBonus +
    rubyFromSenaPass + rubyFromDailyQuest + rubyFrom300Attendance + rubyFromFreeShop + rubyFromWeekend + rubyFromConquest;

  // 🔹 루비 지출
  const rubySpentPerDay = getKeyBoxRubyCostPerDay(keyBoxRuby,keyBoxCount);
  const rubySpent = (rubySpentPerDay + rubyToUse) * days;

  const netProfit = totalRubyIncome - rubySpent;

  console.log("레이드 차감 전 열쇠:", totalKeysBeforeRaid);
  console.log("자연회복 열쇠:", totalNaturalKeys);
  console.log("월정액 열쇠:", keySubKeys);
  console.log("세나패스 열쇠:", keysFromSenaPass);
  console.log("일일의뢰 & 길드출석:", keysFromDailySources);
  console.log("300일 출석표 열쇠:", keysFrom300Attendance);
  console.log("상점 열쇠:", keysFromShop);
  console.log("쫄작 열쇠:", keysForCholjak);
console.log("쫄작 횟수:", runs);
console.log("2주 동안 사용되는 쫄:", heroCount);

  if(keysForCholjak<0){
    return {
      netProfit,
      heroCount:0,
      accessoryDays,
    };
  } else{
      return {
        netProfit,
        heroCount,
        accessoryDays,
      };
    }
}

  const result4w = compute(4);
  document.getElementById("profit4w").innerText = Math.floor(result4w.netProfit).toLocaleString();
  // document.getElementById("avgProfit").innerText = Math.floor(result4w.netProfit / 28).toLocaleString(); // 4주간 일평균 수익
  document.getElementById("accessoryDays").innerText = Math.floor(result4w.accessoryDays).toLocaleString();

  const result2w = compute(2);
  document.getElementById("profit2w").innerText = Math.floor(result2w.netProfit).toLocaleString();
  document.getElementById("avgProfit").innerText = Math.floor(result2w.netProfit / 14).toLocaleString();
  document.getElementById("heroCount").innerText = Math.floor(result2w.heroCount).toLocaleString();
  const avgHero = result2w.heroCount / 14;
  document.getElementById("avgHeroCount").innerText =
    (avgHero % 1 < 0.05 || avgHero % 1 > 0.95)
      ? Math.round(avgHero).toString()
      : avgHero.toFixed(1);
}

// 전제조건 안내 토글
const overlay = document.getElementById("assumptionOverlay");
const openBtn = document.getElementById("showAssumption");
const closeBtn = overlay.querySelector(".close-btn");

openBtn.addEventListener("click", () => {
  overlay.classList.add("show");
});

closeBtn.addEventListener("click", () => {
  overlay.classList.remove("show");
});

// 바깥 영역 클릭 시 닫기
overlay.addEventListener("click", (e) => {
  if (e.target === overlay) {
    overlay.classList.remove("show");
  }
});

const includedItemsOverlay = document.getElementById("includedItemsOverlay");
  const showIncludedItemsBtn = document.getElementById("showIncludedItems");

  showIncludedItemsBtn.addEventListener("click", () => {
    includedItemsOverlay.classList.add("show");
  });

  function closeIncludedItems() {
    includedItemsOverlay.classList.remove("show");
  }

  includedItemsOverlay.addEventListener("click", (e) => {
    if (e.target === includedItemsOverlay) {
      includedItemsOverlay.classList.remove("show");
    }
  });

  // 월정액 설명
const SubModalOverlay = document.getElementById('MonthlySubOverlay');
const openSubModalBtn = document.getElementById('openSubModal');

openSubModalBtn.addEventListener("click", () => {
  SubModalOverlay.classList.add("show");
});

function closeSubModal() {
  SubModalOverlay.classList.remove("show");
}

SubModalOverlay.addEventListener("click", (e) => {
  if (e.target === SubModalOverlay) {
    SubModalOverlay.classList.remove("show");
  }
});

// 세나패스 설명
const SenaPassModalOverlay = document.getElementById('SenaPassOverlay');
const openSenaPassModalBtn = document.getElementById('openSenaPassModal');

openSenaPassModalBtn.addEventListener("click", () => {
  SenaPassModalOverlay.classList.add("show");
});

function closeSenaPassModal() {
  SenaPassModalOverlay.classList.remove("show");
}

SenaPassModalOverlay.addEventListener("click", (e) => {
  if (e.target === SenaPassModalOverlay) {
    SenaPassModalOverlay.classList.remove("show");
  }
});

// 매일 사용 루비 설명
const rubyToUseModalOverlay = document.getElementById('rubyToUseOverlay');
const openrubyToUseModalBtn = document.getElementById('openRubyToUseModal');

openrubyToUseModalBtn.addEventListener("click", () => {
  rubyToUseModalOverlay.classList.add("show");
});

function closeRubyToUseModal() {
  rubyToUseModalOverlay.classList.remove("show");
}

rubyToUseModalOverlay.addEventListener("click", (e) => {
  if (e.target === rubyToUseModalOverlay) {
    rubyToUseModalOverlay.classList.remove("show");
  }
});

  // 숫자 입력이 8 이상이면 자동으로 7로 변경
function enforceMaxValue(id, max) {
  const input = document.getElementById(id);
  input.addEventListener('input', () => {
    let val = parseInt(input.value);
    if (val > max) {
      input.value = max;
    }
  });
}

// 적용 대상 input 요소 등록
enforceMaxValue("honorKeyCount", 7);
enforceMaxValue("guildKeyCount", 7);
enforceMaxValue("arenaKeyCount", 7);
enforceMaxValue("keyBoxCount", 50);

const selectBox = document.getElementById('keyBoxRuby');
const keyBoxCountContainer = document.getElementById('keyBoxCount_container');

// 2. select 상자의 값이 변경될 때마다 함수를 실행하도록 이벤트 리스너를 추가합니다.
selectBox.addEventListener('change', function() {
            // 3. 만약 선택된 option의 value가 'custom'이라면
    if (this.value === '80' || this.value === '100' || this.value === '120') {
                // 입력 상자를 보여줍니다.
        keyBoxCountContainer.style.display = 'inline-block';
    } else {
                // 그 외의 다른 옵션을 선택했다면, 입력 상자를 다시 숨깁니다.
        keyBoxCountContainer.style.display = 'none';
    }});

const senaPassCheckbox = document.getElementById('senaPass');
const premiumCheckbox = document.getElementById('senaPass_premium');
const premiumOptionContainer = document.getElementById('premiumOption');

senaPassCheckbox.addEventListener('change', function() {
  if(this.checked) {
    premiumOptionContainer.style.display = 'inline-block';
  } else {
    premiumCheckbox.checked = false;
    premiumOptionContainer.style.display = 'none';
  }
});

</script>
</body>
</html>
