<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>쫄작 계산기</title>
  <link rel="icon" href="image/favicon.svg" type="image/svg+xml">
  <style>
    @font-face {
    font-family: 'Gyeonggi_Title_Medium';
    src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2410-3@1.0/Title_Medium.woff') format('woff');
    font-weight: 300;
    font-style: normal;
}

    body { 
      font-family: Arial, sans-serif;
      max-width: 600px;
      padding : 15px;
      margin-left: auto;
      margin-right: auto;
    }

    label, h3, h4, h1, ul, select, input[type="checkbox"] {
      -webkit-user-select: none; /* Safari */
      -moz-user-select: none;    /* Firefox */
      -ms-user-select: none;     /* IE/Edge */
      user-select: none;         /* 표준 */
    }

    h1, h3, h4 {
      font-family: 'Gyeonggi_Title_Medium';
      color: #333;
    }

    .section {
      margin-bottom: 0px;
    }

    label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 1px 0;
    }

    label[for="checkboxlabel"] {
      cursor: pointer;
    }

    input[type="number"],
    select {
      flex: 1;
      padding: 6px;
      margin-left: 0px;
      cursor: pointer;
    }
    
    input[type="number"] {
      cursor:text;
    }

    input[type="checkbox"] {
      margin-right: 10px;
      cursor: pointer;
    }

    button {
      font-family: 'Gyeonggi_Title_Medium';
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #calculateBtn {
      margin-top: 20px;
    }

    /* 모바일 터치 및 데스크탑 클릭 피드백 */
  button:active {
    background-color: #45a049;
  }
  /* 데스크탑 마우스 호버 전용 효과 */
  @media (hover: hover) {
    button:hover {
      background-color: #45a049;
    }
  }
    .resetbutton {
      background-color: #ccc; 
      color: #333;
    }
    
    .resetbutton:active {
    background-color: #b4b4b4; 
  }
  @media (hover: hover) {
    .resetbutton:hover {
      background-color: #b4b4b4; 
    }
  }

    .checkbox-row {
      display: flex;
      flex-wrap: nowrap;
      gap: 20px;
      flex-direction: row;
    }

    .overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  display: none;
  justify-content: center;
  align-items: center;
  animation: fadeOut 0.2s ease forwards;
  z-index: 1000;
}

.overlay.show {
  display: flex;
  animation: fadeIn 0.2s ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}
@keyframes fadeOut {
  from { opacity: 1; }
  to   { opacity: 0; }
}

.assumption-box {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  position: relative;
  animation: fadeIn 0.2s ease forwards;
}

.assumption-box h3 {
  margin-top: 0;
}

.assumption-box ul {
  padding-left: 20px;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 20px;
  cursor: pointer;
}

.title-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: nowrap;
  gap: 10px;
  padding: 15px 60px;
  white-space: nowrap;
  overflow: hidden;
}

.title-wrapper h1 {
  font-size: clamp(38px, 5vw, 40px); /* 화면 크기에 따라 자동 조절 */
  margin-bottom: 10px;
  flex-shrink: 1;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.assumption-button {
  background-color: #777;
  transition: background-color 0.15s ease-in-out;
  font-size: 14px;
  padding: 7px 10px;
  white-space: nowrap;
  max-width: 120px;
  min-width: 80px;
  width: auto;
  flex-shrink: 0;
  margin-top: 10px;
}



.assumption-box .credit {
  position: absolute;
  bottom: 10px;
  right: 10px;
  font-size: 13px;
  color: #b6b6b69a;
}

.assumption-button:active {
    background-color: #e06040;
  }
  
  @media (hover: hover) {
    .assumption-button:hover {
      background-color: #e06040;
    }
  }

    .checkbox-label {
      cursor: pointer;
    }

    #raidOver11Level {
      margin-left: 15px;
    }
    .button-column {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
  align-items: flex-start; /* 왼쪽 정렬 (원하면 center로 변경 가능) */
}

/* 입력 상자를 감싸는 컨테이너를 기본적으로 숨김 */
        #keyBoxCount_container {
            display: none;
            margin-left: 10px;
        }

        #premiumOption {
    display: none;
  }

  #openSubModal, #openSenaPassModal, #openRubyToUseModal, #openMedalModal {
    cursor: pointer;
    color: #333;
    transition: color 0.15s ease-in-out;
  }

  #openSubModal:hover, #openSenaPassModal:hover, #openRubyToUseModal:hover, #openMedalModal:hover {
    cursor: pointer;
    color:#e06040
  }

.mobile-break {
  display: inline;
}
.mobile-br {
    display: none;
  }

  .credit::after {
    content: '최종 수정일 2025.09.13';
  }

  .max-btn{
    background-color: #ffffff;
    border: 1px solid #333;
    margin-top: 0;
    margin-left: 10px;
    font-size: auto;
    padding: 7px;
    color: #333;
    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out;
    touch-action: manipulation;
  }

  .btn90, .btn120{
    background-color: #ffffff;
    border: 1px solid #333;
    margin-top: 0;
    margin-left: 0px;
    font-size: auto;
    padding: 7px;
    color: #333;
    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out;
    touch-action: manipulation;
  }

  /* 모바일 터치 및 데스크탑 클릭 피드백 */
  .max-btn:active, .btn90:active, .btn120:active {
    background-color: #999;
    color: #ffffff;
  }

  /* 데스크탑 마우스 호버 전용 효과 */
  @media (hover: hover) {
    .max-btn:hover, .btn90:hover, .btn120:hover {
      background-color: #999;
      color: #ffffff;
    }
  }

  .input-wrapper {
    position: relative;
    display: inline-block;
    align-self: center;
  }
  .tooltip-bubble {
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.2s ease, visibility 0.2s ease;
    position: absolute;
    top: 105%;
    left: 30%;
    transform: translateX(-50%);
    background-color: #e06040;
    color: #fff;
    padding: 4px 7px;
    border-radius: 6px;
    font-size: 14px;
    white-space: nowrap;
    z-index: 10;
    cursor: pointer;
    -webkit-user-select: none; /* Safari */
    -moz-user-select: none;    /* Firefox */
    -ms-user-select: none;     /* IE/Edge */
    user-select: none;         /* 표준 */
  }
  .tooltip-bubble::after {
    content: '';
    position: absolute;
    bottom: 96%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: transparent transparent #e06040 transparent;
  }
  .tooltip-bubble.visible {
    visibility: visible;
    opacity: 1;
  }

  h3 {
    margin-top: 15px;
    margin-bottom: 15px;
  }
  h4 {
    margin-top: 15px;
    margin-bottom: 15px;
  }

  .rubyuseTitle{
    margin-top: 15px;
    margin-bottom: 15px;
  }

  .raidTitle{
    margin-top: 15px;
    margin-bottom:15px;
  }

  #raidSection {
    margin-top: 13px;
  }

  #medalCount {
    width: 100px
  }


    @media (max-width: 480px) {
      .rubyuseTitle {
        line-height: 24px;
        margin-top: 12px;
        margin-bottom: 12px;
      }

      label {
        flex-direction: nowrap;
        align-items: center;
        vertical-align: middle;
      }

      input[type="number"],
      select {
        margin-left: 5px;
        width: 100%;
        align-self: center;
      }

      #arenaKeyCount, #guildKeyCount, #honorKeyCount{
        margin-left: 0px;
        width: 100%;
        margin-top:0px;
      }

      #raidCount{
        width: 80px;
        margin-top: 0;
      }

      .raidTitle{
        line-height: 24px;
        margin-top: 12px;
        margin-bottom: 12px;
      }

      #raidSection {
        margin-top: 10px;
      }

      button {
        width: 100%;
      }

      .max-btn {
        width: auto;
        margin-left: 4px;
      }
      .title-wrapper {
        padding: 8px 25px;
        line-height: 40px;
        margin-left: 8%;
        margin-top: -2%;
        letter-spacing: 0.25em;
      }
      .checkbox-row {
        flex-direction: nowrap; /* 세로 배열로 전환 */
        gap: 10px;
      }
      .mobile-break {
    display: none;
  }
  .mobile-br {
    display: inline;
  }

  .credit::after {
    content: '모바일은 터치로 팝업을 끌 수 있음 | 최종 수정일 2025.09.13';
  }
  .close-btn {
      /* 터치 영역을 넓히기 위해 패딩 추가 */
      padding: 15px;
      top: 0;
      right: 0;
    }
    .modal-scroll-content {
      max-height: 85vh; /* 화면 높이의 85%를 넘지 않도록 설정 */
      overflow-y: auto; /* 내용이 길어지면 스크롤 생성 */
    }
    #conquestSection {
      margin-top: -5px;
    }
    }
  </style>
</head>
<body>

  <div class="title-wrapper">
    <h1>세나리 <span class="mobile-break">쫄작</span> <span class="mobile-br"><br></span> 계산기</h1>
    <div class="button-column">
      <button id="showAssumption" class="assumption-button">전제조건</button>
      <button id="showIncludedItems" class="assumption-button">계산 포함 항목</button>
    </div>
  </div>

  <div id="assumptionOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn">&times;</span>
      <div class="modal-scroll-content">
      <h3>📌 계산 전제조건</h3>
      <ul>
        <li>쫄작은 모험 일반 14영지 이상, 전복률 0% 기준</li>
        <li>열쇠를 최대 보유개수 이상 방치하지 않고 계속 사용</li>
        <li>일일 의뢰, 세나패스 등 일일 퀘스트는 모두 진행</li>
        <li>길드 출석 보상 열쇠 60개</li>
        <li>상점 무료상품 모두 구매</li>
      </ul>
      <h3>📌 유의사항</h3>
      <ul>
        <li>각 카테고리(굵은 글씨)를 클릭하면 관련 설명을 볼 수 있음</li>
        <li>세나패스, 월정액 구매 보너스 등 단기간에 벌어들이는 재화까지 계산에 반영했기 때문에 계산된 2주간 순이익은 실제보다 적음. 계산의 편의를 위해 2주씩 나눠 받는 것으로 계산</li>
        <li>쫄작원정대 열쇠는 쫄작원정대Ⅱ 마지막 사이클 기준</li>
        <li>총력전 루비 보상은 2주에 한번씩 받는 걸로 계산</li>
        <li>잡화상점, 총력전 라운드 출석, 이벤트 보상 등의 불규칙 변수는 계산에 포함하지 않았으므로 계산 전제조건을 만족한다면 실제 모을 수 있는 루비는 계산결과 보다 많음</li>
        <li>모든 계산 결과는 대략적인 수치로 100% 정확하지 않음 (± 80루비 범위 오차)</li>
        </div>
      </ul><div class="credit"></div>
    </div>
  </div>

  <div id="includedItemsOverlay" class="overlay">
  <div class="assumption-box">
    <span class="close-btn" onclick="closeIncludedItems()">&times;</span>
    <h3>🗝️ 계산에 기본 포함된 열쇠</h3>
    <ul>
      <li>자동 충전 열쇠(1일) : 480개(기본) / 720개(월정액)</li>
      <li>일일의뢰 + 길드출석(1일) : 120개</li>
      <li>300일 출석표(10일) : 240개. 1일에 24개로 계산</li>
      <li>주말 푸시보상(1주) : 200개</li>
      <li>상점 무료 열쇠상자(1일) : 60개</li>
    </ul>
    <h3>♦️ 계산에 기본 포함된 루비</h3>
    <ul>
      <li>일일의뢰 + 상점 무료루비(1일) : 130개</li>
      <li>300일 출석표(10일) : 200개. 1일에 20개로 계산</li>
      <li>주말 부스트 보상(1주) : 100개</li>
    </ul>
    <div class="credit"></div>
  </div>
</div>

  <div class="section" style="display: flex; gap: 20px;">
    <h3 id="openSubModal">월정액 여부</h3>
    <div class="checkbox-row">
        <label class="checkbox-label"><input type="checkbox" id="rubySubscription" > 루비 월정액</label>
        <label class="checkbox-label"><input type="checkbox" id="keySubscription" > 열쇠 월정액</label>
    </div>
  </div>

    <div id="MonthlySubOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn" onclick="closeSubModal()">&times;</span>
      <h3>♦️ 루비 월정액 구매 시</h3>
      <ul>
        <li>매일 출석 루비 200개</li>
        <li>월정액 구매 보너스 루비 330개<br>(4주 당 한번, 2주에 165개로 반영)</li>
        <li>모험 경험치 보너스 10% (쫄작 판수 1판 감소)</li>
      </ul>
      <h3>🗝️ 열쇠 월정액 구매 시</h3>
      <ul>
        <li>매일 출석 열쇠 80개</li>
        <li>월정액 구매 보너스 루비 200개<br>(4주 당 한번, 2주에 100개로 반영)</li>
        <li>자동 충전 열쇠 720개 (24시간 기준)</li>
      </ul>
      </ul><div class="credit"></div>
    </div>
  </div>

  <div class="section" style="display: flex; gap: 20px; align-items: center;">
    <h3 id="openSenaPassModal">세나패스</h3>
    <label class="checkbox-label"><input type="checkbox" id="senaPass" > 세나패스 포함</label>
    <span id="premiumOption">
      <label class="checkbox-label"><input type="checkbox" id="senaPass_premium" > 프리미엄 구매</label>
    </span>
  </div>

  <div id="SenaPassOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn" onclick="closeSenaPassModal()">&times;</span>
      <h3>기본 세나패스 풀참 시</h3>
      <ul>
        <li>열쇠 총 480개<br>(2주에 240개로 반영)</li>
        <li>루비 총 500개<br>(2주에 250개로 반영)</li>
      </ul>
      <h3>프리미엄 패스 구매 시</h3>
      <ul>
        <li>기본 보상 포함 열쇠 총 1080개<br>(2주에 540개로 반영)</li>
        <li>기본 보상 포함 루비 총 2900개<br>(2주에 1450개로 반영)</li>
      </ul>
      </ul><div class="credit"></div>
    </div>
  </div>

  <div class="section" style="display: flex; gap: 15px;">
    <h3>열쇠상자 구매</h3>
    <label for="keyBoxRuby">
      <select id="keyBoxRuby">
        <option value="0">구매 안함</option>
        <option value="50">50루비단</option>
        <option value="80">80루비단</option>
        <option value="100">100루비단</option>
        <option value="120">120루비단</option>
      </select>
      <span id="keyBoxCount_container">
            <input type="number" id="keyBoxCount" min="0" max="50" placeholder="기본:50">
    </span>
    </label>
  </div>

  <div class="section">
    <h3>일주일 동안 상점에서 구매할 열쇠 개수</h3>
    <label for="arenaKeyCount">
      ⚔️결투장상점 구매 횟수:
      <button class="max-btn" data-target="arenaKeyCount">최대</button>
      <input type="number" id="arenaKeyCount" min="0" max="7" placeholder="최대 7, 미 입력 시 0">
    </label>

    <label for="honorKeyCount">
      🏵️명예상점 구매 횟수:
      <button class="max-btn" data-target="honorKeyCount">최대</button>
      <input type="number" id="honorKeyCount" min="0" max="7" placeholder="최대 7, 미 입력 시 0">
    </label>

    <label for="guildKeyCount">
      🏅길드상점 구매 횟수:
      <button class="max-btn" data-target="guildKeyCount">최대</button>
      <input type="number" id="guildKeyCount" min="0" max="7" placeholder="최대 7, 미 입력 시 0">
    </label>
  </div>

  <div class="section" id="raidSection" style="display: flex; gap: 10px;">
      <h3 class="raidTitle">하루 레이드<span class="mobile-br"><br></span> 판 수</h3>
     <div class="input-wrapper"> 
      <label for="raidCount">
        <input type="number" id="raidCount" min="0" placeholder="미 입력 시 0">
        <label class="checkbox-label"><input type="checkbox" id="raidOver11Level" checked>11단계 이상</label>
      </label>
      <div id="raidTooltip" class="tooltip-bubble">레이드에 소모되는 열쇠가 너무 많음!</div>
    </div>
  </div>

  <div class="section" id="conquestSection" style="display: flex; gap: 20px;">
    <h3>총력전 티어</h3>
    <label for="conquestTier">
      <select id="conquestTier">
        <option value="none">선택 안함</option>
        <option value="common">일반</option>
        <option value="advanced">고급</option>
        <option value="rare">희귀</option>
        <option value="legend">전설</option>
      </select>
    </label>
  </div>

  <div class="section" style="display: flex; gap: 20px;">
    <h3 id="openMedalModal">시련의 탑 메달</h3>
    <label for="medalCount">
      <button class="btn90" data-target="medalCount">90개</button>
      <button class="btn120" data-target="medalCount">120개</button>
      <input type="number" id="medalCount" min="0" max="120" placeholder="미 입력 시 0">
    </label>
  </div>

  <div id="medalOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn" onclick="closeMedalModal()">&times;</span>
      <h3>시련의 탑 메달 별 루비 보상</h3>
      <ul>
        <li>4주마다 초기화 되기 때문에 2주는 절반으로 반영</li>
        <li>10~19개 : 100루비</li>
        <li>20~29개 : 200루비</li>
        <li>30~39개 : 300루비</li>
        <li>40~49개 : 400루비</li>
        <li>50~69개 : 500루비</li>
        <li>70~79개 : 600루비</li>
        <li>80~99개 : 700루비</li>
        <li>100~109개 : 1000루비</li>
        <li>110~120개 : 1500루비</li>
      </ul>
      </ul><div class="credit"></div>
    </div>
  </div>

<div class="section" style="display: flex; gap: 20px;">
  <h3>쫄작원정대 열쇠 포함</h3>
  <label class="checkbox-label"><input type="checkbox" id="includeExpeditionKey" checked> 포함하여 계산</label>
</div>

<div class="section" style="display: flex; gap: 10px;">
  <h3 id="openRubyToUseModal" class="rubyuseTitle">매일 일정하게 <span class="mobile-br"><br></span>사용할 루비</h3>
  <label for="rubyToUse">
      <input type="number" id="rubyToUse" min="0" placeholder="미 입력 시 0">
    </label>
</div>

<div id="rubyToUseOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn" onclick="closeRubyToUseModal()">&times;</span>
      <h3>♟️ 세나체스 누적 루비 비용</h3>
      <ul>
        <li>누적 2회 : 50루비</li>
        <li>누적 3회 : 150루비</li>
        <li>4회차 이상 : + 150루비씩</li>
      </ul>
      <h3>🎫 성장던전 티켓 구매비용</h3>
      <ul>
        <li>1장 : 100루비</li>
        <li>2장 : 250루비</li>
        <li>3장 : 450루비</li>
        <li>4장 : 750루비</li>
        <li>5장 이상 : + 500루비씩</li>
      </ul>
      </ul><div class="credit"></div>
    </div>
  </div>

  <div class="section">
    <button id="calculateBtn" onclick="calculateProfit()">💰 루비 순이익 계산하기</button>
    <button onclick="resetForm()" class="resetbutton">🔄 초기화</button>
    <h3>📆 2주간 루비 순이익: <span id="profit2w">0</span> 루비</h3>
    <h3>📆 4주간 루비 순이익: <span id="profit4w">0</span> 루비</h3>
    <h3>♦️ 일평균 루비 순이익: <span id="avgProfit">0</span> 루비</h3>
    <h4>👥 2주간 만렙찍는 쫄 수: <span id="heroCount">0</span> 마리</h3>
    <h4>📊 하루 평균 만렙찍는 쫄 수: <span id="avgHeroCount">0</span> 마리</h3>
    <h4>💍 악몽 전설 장신구 천장 소요 기간 : <span id="accessoryDays">0</span> 일</h3>
  </div>
<script>
  const raidTooltip = document.getElementById("raidTooltip");

  function resetForm() {
  //툴팁 초기화
  raidTooltip.classList.remove('visible');

  // 동적 숫자 입력 초기화
  document.getElementById("keyBoxCount_container").style.display = 'none';

  // 체크박스 초기화
  document.getElementById("rubySubscription").checked = false;
  document.getElementById("keySubscription").checked = false;
  document.getElementById("senaPass").checked = false;
  document.getElementById("senaPass_premium").checked = false;
  document.getElementById("raidOver11Level").checked = true;
  document.getElementById("includeExpeditionKey").checked = true;

  // 셀렉트 초기화
  document.getElementById("keyBoxRuby").value = "0";
  document.getElementById("conquestTier").value = "none";

  // 숫자 입력 초기화
  document.getElementById("honorKeyCount").value = "";
  document.getElementById("guildKeyCount").value = "";
  document.getElementById("arenaKeyCount").value = "";
  document.getElementById("raidCount").value = "";
  document.getElementById("keyBoxCount").value = "";
  document.getElementById("rubyToUse").value = "";
  document.getElementById("medalCount").value = "";

  // 결과창 초기화
  document.getElementById("profit2w").innerText = "0";
  document.getElementById("profit4w").innerText = "0";
  document.getElementById("avgProfit").innerText = "0";
  document.getElementById("heroCount").innerText = "0";
  document.getElementById("avgHeroCount").innerText = "0";
  document.getElementById("accessoryDays").innerText = "0";
}

function calculateProfit() {
  const playsForLegendAccessory = 15000;
  const rubySub = document.getElementById("rubySubscription").checked;
  const keySub = document.getElementById("keySubscription").checked;
  const senaPass = document.getElementById("senaPass").checked;
  const senaPassPremium = document.getElementById("senaPass_premium").checked;
  const raid11Lev = document.getElementById("raidOver11Level").checked;
  const honorCount = parseInt(document.getElementById("honorKeyCount").value) || 0;
  const guildCount = parseInt(document.getElementById("guildKeyCount").value) || 0;
  const arenaCount = parseInt(document.getElementById("arenaKeyCount").value) || 0;
  const keyBoxRuby = parseInt(document.getElementById("keyBoxRuby").value) || 0;
  const parsedBoxCount = parseInt(document.getElementById("keyBoxCount").value);
  const keyBoxCount = isNaN(parsedBoxCount) ? 50 : parsedBoxCount;
  const raidCountPerDay = parseInt(document.getElementById("raidCount").value) || 0;
  const conquestTier = document.getElementById("conquestTier").value;
  const includeExpeditionKey = document.getElementById("includeExpeditionKey").checked;
  const rubyToUse = parseInt(document.getElementById("rubyToUse").value) || 0;
  const medalCount = parseInt(document.getElementById("medalCount").value) || 0;

  function getKeyBoxRubyCostPerDay(rubyTier, boxCount) {
    let cost = 0;
    if (rubyTier >= 50) cost += 50 * 20;
    if (rubyTier >= 80) cost += 80 * 50;
    if (rubyTier >= 100) cost += 100 * 50;
    if (rubyTier >= 120) cost += 120 * 50;
    cost -= rubyTier*(50-boxCount);
    return cost;
  }

  function getConquestRuby(tier, weeks) {
    if (weeks < 2) return 0;
    if (tier === "legend") return 6400 * (weeks / 2);
    if (tier === "rare") return 3400 * (weeks / 2);
    if (tier === "advanced") return 1400 * (weeks / 2);
    if (tier === "common") return 200 * (weeks / 2);
    return 0;
  }

  function towerOfTrialRuby(medal) {
    if (medal >= 10 && medal < 20) return 100;
    if (medal >= 20 && medal < 30) return 200;
    if (medal >= 30 && medal < 40) return 300;
    if (medal >= 40 && medal < 50) return 400;
    if (medal >= 50 && medal < 70) return 500;
    if (medal >= 70 && medal < 80) return 600;
    if (medal >= 80 && medal < 100) return 700;
    if (medal >= 100 && medal < 110) return 1000;
    if (medal >= 110) return 1500;
    return 0;
  }

 function compute(period) {
  const days = period * 7;
  const weeks = period;

  // 🔹 열쇠 수급
  const naturalKeyPerDay = keySub ? 720 : 480;
  const totalNaturalKeys = naturalKeyPerDay * days;
  const keySubKeys = keySub ? (period === 2 ? 1120 : 2240) : 0;
  const keysFromSenaPass = senaPass ? (senaPassPremium ? (period === 2 ? 540 : 1080) : (period === 2 ? 240 : 480)) : 0; // 구매 후 2주안에 끝내는걸 반영할 경우 senaPass ? (senaPassPremium ? 1080 : 480) : 0;
  const keysFromDailySources = (60 + 60) * days; // 일일의뢰 + 길드출석
  const keysFrom300Attendance = 24 * days; // 300일 출석표 열쇠. 10일에 240개 이므로 하루에 24개로 계산
  const keysFromShop = (honorCount + guildCount + arenaCount) * 60 * weeks; // 명예 & 길드 상점
  const keysFromWeekend = 200 * weeks; // 주말 푸시 열쇠 (토,일 100개씩)
  const keysFromKeyBox = ((1 + 
    (keyBoxRuby >= 50 ? 20 : 0) +
    (keyBoxRuby >= 80 ? 50 : 0) +
    (keyBoxRuby >= 100 ? 50 : 0) +
    (keyBoxRuby >= 120 ? 50 : 0) - (50-keyBoxCount)) * 60) * days;

  const totalKeysBeforeRaid = totalNaturalKeys + keySubKeys + keysFromSenaPass +
    keysFromDailySources + keysFrom300Attendance + keysFromShop + keysFromWeekend + keysFromKeyBox;

  // 🔹 레이드 차감
  const raidKeysUsed = raid11Lev ? (raidCountPerDay * 12 * days) : (raidCountPerDay * 6 * days) ; // 레이드에 사용되는 열쇠 수. 11단계 이상일 경우 판당 12개 차감
  const keysForCholjak = totalKeysBeforeRaid - raidKeysUsed; // 레이드 열쇠 차감 후 쫄작용 열쇠
  // 레이드 열쇠 소모량이 총 열쇠보다 많을 경우 → 경고 출력
    if (keysForCholjak < 0) {
      raidTooltip.classList.add('visible');
      // return {
      //   netProfit: 0,
      //   heroCount: 0
      // }; // 계산 중단
    } else {
      raidTooltip.classList.remove('visible');
    }

  // 🔹 정확한 쫄작원정대 루프 계산 방식 적용
  const externalRuns = keysForCholjak / 6; // 쫄작원정대 열쇠 이외 열쇠로 쫄작돌리는 횟수
  let totalCholjakKeys = keysForCholjak;
    if (includeExpeditionKey) {
      const choljakQuestKeys = (externalRuns / 2115) * 270; // 2160(쫄작원정대 마지막 사이클 횟수) - 45(쫄작원정대 열쇠로 돌릴 수 있는 횟수) = 2115
      totalCholjakKeys += choljakQuestKeys;

      console.log("원정대 열쇠 보상:", choljakQuestKeys);
    } else {
      console.log("원정대 열쇠 포함하지 않음");
    }

  // 악몽 전설 장신구 천장 소요기간 계산
  let accessoryDays = playsForLegendAccessory / ((totalCholjakKeys / 12) / days);

  // 🔹 쫄작 루비 수익
  const keysPerRun = rubySub ? 60 : 66;
  const runs = totalCholjakKeys / keysPerRun;
  const heroCount = runs * 4;
  const rubyFromCholjak = runs * 80;

  // 🔹 기타 루비 수급
  const rubyFromRubySub = rubySub ? (days * 200 + (period === 2 ? 165 : 330)) : 0;
  const rubyFromKeySubBonus = keySub ? (period === 2 ? 100 : 200) : 0;
  const rubyFromSenaPass = senaPass ? (senaPassPremium ? (period === 2 ? 1450 : 2900) : (period === 2 ? 250 : 500)) : 0; // (senaPassPremium ? 2900 : 500) : 0;
  const rubyFromDailyQuest = 100 * days;
  const rubyFrom300Attendance = 20 * days; // 300일 출석표 루비. 10일에 200개 이므로 하루에 20개로 계산
  const rubyFromFreeShop = 30 * days;
  const rubyFromWeekend = 100 * weeks;
  const rubyFromConquest = getConquestRuby(conquestTier, weeks);
  const rubyFromTrial = (period === 2 ? (towerOfTrialRuby(medalCount) / 2) : towerOfTrialRuby(medalCount));

  const totalRubyIncome = rubyFromCholjak + rubyFromRubySub + rubyFromKeySubBonus +
    rubyFromSenaPass + rubyFromDailyQuest + rubyFrom300Attendance + rubyFromFreeShop + rubyFromWeekend + rubyFromConquest + rubyFromTrial;

  // 🔹 루비 지출
  const rubySpentPerDay = getKeyBoxRubyCostPerDay(keyBoxRuby,keyBoxCount);
  const rubySpent = (rubySpentPerDay + rubyToUse) * days;

  const netProfit = totalRubyIncome - rubySpent;

  console.log("레이드 차감 전 열쇠:", totalKeysBeforeRaid);
  console.log("자연회복 열쇠:", totalNaturalKeys);
  console.log("월정액 열쇠:", keySubKeys);
  console.log("세나패스 열쇠:", keysFromSenaPass);
  console.log("일일의뢰 & 길드출석:", keysFromDailySources);
  console.log("300일 출석표 열쇠:", keysFrom300Attendance);
  console.log("상점 열쇠:", keysFromShop);
  console.log("쫄작 열쇠:", keysForCholjak);
console.log("쫄작 횟수:", runs);
console.log("2주 동안 사용되는 쫄:", heroCount);

  if(keysForCholjak<0){
    return {
      netProfit,
      heroCount:0,
      accessoryDays,
    };
  } else{
      return {
        netProfit,
        heroCount,
        accessoryDays,
      };
    }
}

  const result4w = compute(4);
  document.getElementById("profit4w").innerText = Math.round(result4w.netProfit).toLocaleString();
  // document.getElementById("avgProfit").innerText = Math.floor(result4w.netProfit / 28).toLocaleString(); // 4주간 일평균 수익
  document.getElementById("accessoryDays").innerText = Math.round(result4w.accessoryDays).toLocaleString();

  const result2w = compute(2);
  document.getElementById("profit2w").innerText = Math.round(result2w.netProfit).toLocaleString();
  document.getElementById("avgProfit").innerText = Math.round(result2w.netProfit / 14).toLocaleString();
  document.getElementById("heroCount").innerText = Math.floor(result2w.heroCount).toLocaleString();
  const avgHero = result2w.heroCount / 14;
  document.getElementById("avgHeroCount").innerText =
    (avgHero % 1 < 0.05 || avgHero % 1 > 0.95)
      ? Math.round(avgHero).toString()
      : avgHero.toFixed(1);
}

// 전제조건 안내 토글
const overlay = document.getElementById("assumptionOverlay");
const openBtn = document.getElementById("showAssumption");
const closeBtn = overlay.querySelector(".close-btn");
const assumptionBoxes = document.querySelectorAll(".assumption-box");

openBtn.addEventListener("click", () => {
  overlay.classList.add("show");
});

closeBtn.addEventListener("click", () => {
  overlay.classList.remove("show");
});

// 바깥 영역 클릭 시 닫기
overlay.addEventListener("click", (e) => {
  if (e.target === overlay) {
    overlay.classList.remove("show");
  }
});

const includedItemsOverlay = document.getElementById("includedItemsOverlay");
  const showIncludedItemsBtn = document.getElementById("showIncludedItems");

  showIncludedItemsBtn.addEventListener("click", () => {
    includedItemsOverlay.classList.add("show");
  });

  function closeIncludedItems() {
    includedItemsOverlay.classList.remove("show");
  }

  includedItemsOverlay.addEventListener("click", (e) => {
    if (e.target === includedItemsOverlay) {
      includedItemsOverlay.classList.remove("show");
    }
  });

  // 월정액 설명
const SubModalOverlay = document.getElementById('MonthlySubOverlay');
const openSubModalBtn = document.getElementById('openSubModal');

openSubModalBtn.addEventListener("click", () => {
  SubModalOverlay.classList.add("show");
});

function closeSubModal() {
  SubModalOverlay.classList.remove("show");
}

SubModalOverlay.addEventListener("click", (e) => {
  if (e.target === SubModalOverlay) {
    SubModalOverlay.classList.remove("show");
  }
});

// 세나패스 설명
const SenaPassModalOverlay = document.getElementById('SenaPassOverlay');
const openSenaPassModalBtn = document.getElementById('openSenaPassModal');

openSenaPassModalBtn.addEventListener("click", () => {
  SenaPassModalOverlay.classList.add("show");
});

function closeSenaPassModal() {
  SenaPassModalOverlay.classList.remove("show");
}

SenaPassModalOverlay.addEventListener("click", (e) => {
  if (e.target === SenaPassModalOverlay) {
    SenaPassModalOverlay.classList.remove("show");
  }
});

// 매일 사용 루비 설명
const rubyToUseModalOverlay = document.getElementById('rubyToUseOverlay');
const openrubyToUseModalBtn = document.getElementById('openRubyToUseModal');

openrubyToUseModalBtn.addEventListener("click", () => {
  rubyToUseModalOverlay.classList.add("show");
});

function closeRubyToUseModal() {
  rubyToUseModalOverlay.classList.remove("show");
}

rubyToUseModalOverlay.addEventListener("click", (e) => {
  if (e.target === rubyToUseModalOverlay) {
    rubyToUseModalOverlay.classList.remove("show");
  }
});

// 시련의 탑 메달 설명
const medalModalOverlay = document.getElementById('medalOverlay');
const openMedalModalBtn = document.getElementById('openMedalModal');

openMedalModalBtn.addEventListener("click", () => {
  medalModalOverlay.classList.add("show");
});

function closeMedalModal() {
  medalModalOverlay.classList.remove("show");
}

medalModalOverlay.addEventListener("click", (e) => {
  if (e.target === medalModalOverlay) {
    medalModalOverlay.classList.remove("show");
  }
});

// 페이지에 있는 모든 설명창(.assumption-box)을 선택합니다.
const allAssumptionBoxes = document.querySelectorAll('.assumption-box');

// 선택된 모든 설명창에 대해 각각 클릭 이벤트를 추가합니다.
allAssumptionBoxes.forEach(box => {
  box.addEventListener('click', function(event) {
    
    // 1. 모바일 화면인지 확인합니다 (화면 너비 480px 이하)
    if (window.innerWidth <= 480) {
      
      // 2. 만약 클릭한 대상이 닫기(X) 버튼이라면,
      //    중복 실행을 막기 위해 여기서 함수를 종료합니다.
      if (event.target.closest('.close-btn')) {
        return;
      }
      
      // 3. 클릭된 설명창의 부모 .overlay를 찾습니다.
      const parentOverlay = this.closest('.overlay');
      
      // 4. 부모 overlay를 찾았다면, 'show' 클래스를 제거하여 창을 닫습니다.
      if (parentOverlay) {
        parentOverlay.classList.remove("show");
      }
    }
  });
});

  // 숫자 입력이 최대 이상이면 자동으로 최대로 변경
function enforceMaxValue(id, max) {
  const input = document.getElementById(id);
  input.addEventListener('input', () => {
    let val = parseInt(input.value);
    if (val > max) {
      input.value = max;
    }
  });
}

// 적용 대상 input 요소 등록
enforceMaxValue("honorKeyCount", 7);
enforceMaxValue("guildKeyCount", 7);
enforceMaxValue("arenaKeyCount", 7);
enforceMaxValue("keyBoxCount", 50);
enforceMaxValue("medalCount", 120);

const selectBox = document.getElementById('keyBoxRuby');
const keyBoxCountContainer = document.getElementById('keyBoxCount_container');
const keyBoxCount = document.getElementById('keyBoxCount');

// 2. select 상자의 값이 변경될 때마다 함수를 실행하도록 이벤트 리스너를 추가합니다.
selectBox.addEventListener('change', function() {
            // 3. 만약 선택된 option의 value가 'custom'이라면
    if (this.value === '80' || this.value === '100' || this.value === '120') {
                // 입력 상자를 보여줍니다.
        keyBoxCountContainer.style.display = 'inline-block';
        keyBoxCount.value = '';
    } else {
                // 그 외의 다른 옵션을 선택했다면, 입력 상자를 다시 숨깁니다.
        keyBoxCountContainer.style.display = 'none';
        keyBoxCount.value = '';
    }});

const senaPassCheckbox = document.getElementById('senaPass');
const premiumCheckbox = document.getElementById('senaPass_premium');
const premiumOptionContainer = document.getElementById('premiumOption');

senaPassCheckbox.addEventListener('change', function() {
  if(this.checked) {
    premiumOptionContainer.style.display = 'inline-block';
  } else {
    premiumCheckbox.checked = false;
    premiumOptionContainer.style.display = 'none';
  }
});

// --- 최대값 입력 버튼 기능 스크립트 ---
  const maxButtons = document.querySelectorAll('.max-btn');

  maxButtons.forEach(button => {
    button.addEventListener('click', function() {
      // 1. 버튼의 'data-target' 속성에서 연결된 input의 id를 가져옵니다.
      const targetId = this.dataset.target;
      const targetInput = document.getElementById(targetId);

      // 2. 해당 input을 찾아서 그 input의 'max' 속성값을 'value'에 넣어줍니다.
      if (targetInput) {
        targetInput.value = targetInput.max;
      }
    });
  });

  // 필요한 HTML 요소들을 ID와 클래스 이름으로 선택합니다.
            const medalCountInput = document.getElementById('medalCount');
            const btn90 = document.querySelector('.btn90');
            const btn120 = document.querySelector('.btn120');

            // '90개' 버튼에 클릭 이벤트 리스너를 추가합니다.
            btn90.addEventListener('click', (event) => {
                // 버튼의 기본 동작(예: form 안에 있을 경우 form 제출)을 막습니다.
                event.preventDefault(); 
                // 입력 칸의 값을 90으로 설정합니다.
                medalCountInput.value = 90;
            });

            // '120개' 버튼에 클릭 이벤트 리스너를 추가합니다.
            btn120.addEventListener('click', (event) => {
                // 버튼의 기본 동작을 막습니다.
                event.preventDefault();
                // 입력 칸의 값을 120으로 설정합니다.
                medalCountInput.value = 120;
            });


// 툴팁 자체에 클릭 이벤트 리스너를 추가합니다.
raidTooltip.addEventListener('click', function() {
  // 클릭된 툴팁(this)에서 'visible' 클래스를 제거하여 숨깁니다.
  this.classList.remove('visible');
});
</script>
</body>
</html>
