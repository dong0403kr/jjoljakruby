<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>세나리 쫄작 루비 계산기</title>
  <style>
    @font-face {
    font-family: 'Gyeonggi_Title_Medium';
    src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2410-3@1.0/Title_Medium.woff') format('woff');
    font-weight: 300;
    font-style: normal;
}

    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      padding : 15px;
      margin-left: auto;
      margin-right: auto;
    }

    label, h3, h4, h1, select, input[type="checkbox"] {
      -webkit-user-select: none; /* Safari */
      -moz-user-select: none;    /* Firefox */
      -ms-user-select: none;     /* IE/Edge */
      user-select: none;         /* 표준 */
    }

    h1, h3, h4 {
      font-family: 'Gyeonggi_Title_Medium';
      color: #333;
    }

    .section {
      margin-bottom: 10px;
    }

    label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 8px 0;
    }

    label[for="checkboxlabel"] {
      cursor: pointer;
    }

    input[type="number"],
    select {
      flex: 1;
      padding: 6px;
      margin-left: 10px;
      cursor: pointer;
    }
    
    input[type="number"] {
      cursor:text;
    }

    input[type="checkbox"] {
      margin-right: 10px;
      cursor: pointer;
    }

    button {
      font-family: 'Gyeonggi_Title_Medium';
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    .resetbutton {
      background-color: #ccc; 
      color: #333;
    }
    
    .resetbutton:hover {
      background-color: #b4b4b4; 
    }

    .checkbox-row {
      display: flex;
      flex-wrap: nowrap;
      gap: 20px;
      flex-direction: row;
    }

    .overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  display: none;
  justify-content: center;
  align-items: center;
  animation: fadeOut 0.3s ease forwards;
  z-index: 1000;
}

.overlay.show {
  display: flex;
  animation: fadeIn 0.3s ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}
@keyframes fadeOut {
  from { opacity: 1; }
  to   { opacity: 0; }
}

.assumption-box {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  position: relative;
  animation: fadeIn 0.3s ease forwards;
}

.assumption-box h3 {
  margin-top: 0;
}

.assumption-box ul {
  padding-left: 20px;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 20px;
  cursor: pointer;
}

.title-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: nowrap;
  gap: 10px;
  padding: 15px 60px;
  white-space: nowrap;
  overflow: hidden;
}

.title-wrapper h1 {
  font-size: clamp(30px, 5vw, 34px); /* 화면 크기에 따라 자동 조절 */
  margin-bottom: 10px;
  flex-shrink: 1;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.assumption-button {
  background-color: #777;
  font-size: 14px;
  padding: 7px 10px;
  white-space: nowrap;
  max-width: 120px;
  min-width: 80px;
  width: auto;
  flex-shrink: 0;
  margin-top: 10px;
}



.assumption-box .credit {
  position: absolute;
  bottom: 10px;
  right: 10px;
  font-size: 13px;
  color: #999;
}

.assumption-button:hover {
      background-color: #e06040;
    }

    .checkbox-label {
      cursor: pointer;
    }

    .button-column {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
  align-items: flex-start; /* 왼쪽 정렬 (원하면 center로 변경 가능) */
}

.mobile-break {
  display: none;
}

    @media (max-width: 480px) {
      label {
        flex-direction: nowrap;
        align-items: center;
        vertical-align: middle;
      }

      input[type="number"],
      select {
        margin-left: 10px;
        width: 100%;
        margin-top: 5px;
      }

      button {
        width: 100%;
      }

      .title-wrapper {
        padding: 15px 20px;
        margin-left: 5%;
      }
      .checkbox-row {
        flex-direction: nowrap; /* 세로 배열로 전환 */
        gap: 10px;
      }
      .mobile-break {
    display: inline;
  }
    }
  </style>
</head>
<body>

  <div class="title-wrapper">
    <h1>세나리 쫄작 <span class="mobile-break"><br></span>루비 계산기</h1>
    <div class="button-column">
      <button id="showAssumption" class="assumption-button">전제조건</button>
      <button id="showIncludedItems" class="assumption-button">계산 포함 항목</button>
    </div>
  </div>

  <div id="assumptionOverlay" class="overlay">
    <div class="assumption-box">
      <span class="close-btn">&times;</span>
      <h3>📌 계산 전제조건</h3>
      <ul>
        <li>쫄작은 모험 일반 14영지 이상, 전복률 0% 기준</li>
        <li>열쇠를 최대 보유개수 이상 방치하지 않고 계속 사용</li>
        <li>일일 의뢰, 세나패스 등 일일 퀘스트는 모두 진행</li>
        <li>길드 출석 보상 열쇠 60개</li>
        <li>상점 무료상품 모두 구매</li>
      </ul>
      <h3>📌 유의사항</h3>
      <ul>
        <li>쫄작원정대 열쇠는 쫄작원정대Ⅱ 마지막 사이클 기준</li>
        <li>총력전 루비 보상은 2주에 한번씩 받는 걸로 계산</li>
        <li>세나패스는 현재 4주에 한번씩 초기화되는 상황, 초기화 이후 12일이면 모든 보상을 받을 수 있으므로, 
          2주와 4주 순이익에 세나패스가 미치는 영향이 서로 같도록 처리함. 한 번의 세나패스로 받을 수 있는 모든 보상으로 계산 (4주 동안 세나패스를 2번 걸쳐 진행하는 경우는 고려하지 않음)
        </li>
        <li>잡화상점, 총력전 출석, 이벤트 보상 등의 다른 변수는 계산에 포함하지 않았으므로 계산 전제조건을 만족한다면 실제 모을 수 있는 루비는 계산결과 보다 많음</li>
        <li>모든 계산 결과는 대략적인 수치로 100% 정확하지 않음 (± 80루비 범위 오차)</li>
      </ul><div class="credit">Made by 무과금전향</div>
    </div>
  </div>

  <div id="includedItemsOverlay" class="overlay">
  <div class="assumption-box">
    <span class="close-btn" onclick="closeIncludedItems()">&times;</span>
    <h3>🗝️ 계산에 기본 포함된 열쇠</h3>
    <ul>
      <li>자동 충전 열쇠(1일) : 480개(기본) / 720개(월정액)</li>
      <li>세나패스 열쇠(28일 중 12일) : 480개(일반) / 1080개(프리미엄)</li>
      <li>일일의뢰 + 길드출석(1일) : 120개</li>
      <li>300일 출석표(10일) : 240개. 1일에 24개로 계산</li>
      <li>주말 푸시보상(1주) : 200개</li>
      <li>상점 무료 열쇠상자(1일) : 60개</li>
    </ul>
    <h3>♦️ 계산에 기본 포함된 루비</h3>
    <ul>
      <li>세나패스 루비(28일 중 12일) : 500개(일반) / 2900개(프리미엄)</li>
      <li>일일의뢰 + 상점 무료루비(1일) : 130개</li>
      <li>300일 출석표(10일) : 200개. 1일에 20개로 계산</li>
      <li>주말 부스트 보상(1주) : 100개</li>
    </ul>
    <div class="credit">Made by 무과금전향</div>
  </div>
</div>

  <div class="section" style="display: flex; gap: 20px;">
    <h3>월정액 여부</h3>
    <div class="checkbox-row">
        <label class="checkbox-label"><input type="checkbox" id="rubySubscription" > 루비 월정액</label>
        <label class="checkbox-label"><input type="checkbox" id="keySubscription" > 열쇠 월정액</label>
    </div>
  </div>

  <div class="section" style="display: flex; gap: 20px;">
    <h3>세나패스</h3>
    <label class="checkbox-label"><input type="checkbox" id="senaPass" > 세나패스 구매함</label>
  </div>

  <div class="section" style="display: flex; gap: 20px;">
    <h3>열쇠상자 구매</h3>
    <label for="keyBoxRuby">
      사용할 루비:
      <select id="keyBoxRuby">
        <option value="0">구매 안함</option>
        <option value="50">50루비단</option>
        <option value="80">80루비단</option>
        <option value="100">100루비단</option>
        <option value="120">120루비단</option>
      </select>
    </label>
  </div>

  <div class="section">
    <h3>일주일 동안 상점에서 구매할 열쇠 개수</h3>
    <label for="honorKeyCount">
      명예상점 구매 횟수:
      <input type="number" id="honorKeyCount" min="0" max="7" placeholder="예: 3">
    </label>

    <label for="guildKeyCount">
      길드상점 구매 횟수:
      <input type="number" id="guildKeyCount" min="0" max="7" placeholder="예: 2">
    </label>
  </div>

  <div class="section">
    <div style="display: flex; align-items: center; gap: 10px;">
      <h3>하루 레이드 판 수</h3>
      <span id="raidWarning" style="color: red; font-size: 14px; display: none;">
        레이드 판 수가 너무 많습니다.
      </span>
    </div>
    <label for="raidCount">
      레이드 판 수:
      <input type="number" id="raidCount" min="0" placeholder="예: 10">
    </label>
  </div>

  <div class="section">
    <h3>총력전 티어</h3>
    <label for="conquestTier">
      티어 선택:
      <select id="conquestTier">
        <option value="none">선택 안함</option>
        <option value="common">일반</option>
        <option value="advanced">고급</option>
        <option value="rare">희귀</option>
        <option value="legend">전설</option>
      </select>
    </label>
  </div>

  <!-- ✅ 쫄작원정대 열쇠 포함 여부 -->
<div class="section" style="display: flex; gap: 20px;">
  <h3>쫄작원정대 열쇠 포함</h3>
  <label class="checkbox-label"><input type="checkbox" id="includeExpeditionKey" checked> 포함하여 계산</label>
</div>

  <div class="section">
    <button onclick="calculateProfit()">💰 루비 순이익 계산하기</button>
    <button onclick="resetForm()" class="resetbutton">🔄 초기화</button>
    <h3>📆 2주간 루비 순이익: <span id="profit2w">0</span> 루비</h3>
    <h3>📆 4주간 루비 순이익: <span id="profit4w">0</span> 루비</h3>
    <h3>📈 하루 평균 루비 순이익: <span id="avgProfit">0</span> 루비</h3>
    <h3>👥 2주 동안 사용되는 쫄 수: <span id="heroCount">0</span> 마리</h4>
    <h3>📊 하루 평균 사용되는 쫄 수: <span id="avgHeroCount">0</span> 마리</h4>
  </div>
<script>

  function resetForm() {
  
    //경고문 초기화
  document.getElementById("raidWarning").style.display = "none";
    
  // 체크박스 초기화
  document.getElementById("rubySubscription").checked = false;
  document.getElementById("keySubscription").checked = false;
  document.getElementById("senaPass").checked = false;
  document.getElementById("includeExpeditionKey").checked = true;

  // 셀렉트 초기화
  document.getElementById("keyBoxRuby").value = "0";
  document.getElementById("conquestTier").value = "none";

  // 숫자 입력 초기화
  document.getElementById("honorKeyCount").value = "";
  document.getElementById("guildKeyCount").value = "";
  document.getElementById("raidCount").value = "";

  // 결과창 초기화
  document.getElementById("profit2w").innerText = "0";
  document.getElementById("profit4w").innerText = "0";
  document.getElementById("avgProfit").innerText = "0";
  document.getElementById("heroCount").innerText = "0";
  document.getElementById("avgHeroCount").innerText = "0";
}

function calculateProfit() {
  const rubySub = document.getElementById("rubySubscription").checked;
  const keySub = document.getElementById("keySubscription").checked;
  const senaPass = document.getElementById("senaPass").checked;
  const honorCount = parseInt(document.getElementById("honorKeyCount").value) || 0;
  const guildCount = parseInt(document.getElementById("guildKeyCount").value) || 0;
  const keyBoxRuby = parseInt(document.getElementById("keyBoxRuby").value) || 0;
  const raidCountPerDay = parseInt(document.getElementById("raidCount").value) || 0;
  const conquestTier = document.getElementById("conquestTier").value;
  const includeExpeditionKey = document.getElementById("includeExpeditionKey").checked;

  function getKeyBoxRubyCostPerDay(rubyTier) {
    let cost = 0;
    if (rubyTier >= 50) cost += 50 * 20;
    if (rubyTier >= 80) cost += 80 * 50;
    if (rubyTier >= 100) cost += 100 * 50;
    if (rubyTier >= 120) cost += 120 * 50;
    return cost;
  }

  function getConquestRuby(tier, weeks) {
    if (weeks < 2) return 0;
    if (tier === "legend") return 6400 * (weeks / 2);
    if (tier === "rare") return 3400 * (weeks / 2);
    if (tier === "advanced") return 1400 * (weeks / 2);
    if (tier === "common") return 200 * (weeks / 2);
    return 0;
  }

 function compute(period) {
  const days = period * 7;
  const weeks = period;

  // 🔹 열쇠 수급
  const naturalKeyPerDay = keySub ? 720 : 480;
  const totalNaturalKeys = naturalKeyPerDay * days;
  const keySubKeys = keySub ? (period === 2 ? 1120 : 2240) : 0;
  const keysFromSenaPass = senaPass ? 1080 : 480; // 구매 후 2주안에 끝낸다는 가정 하에(period === 2 ? 540 : 1080) : (period === 2 ? 240 : 480);
  const keysFromDailySources = (60 + 60) * days; // 일일의뢰 + 길드출석
  const keysFrom300Attendance = 24 * days; // 300일 출석표 열쇠. 10일에 240개 이므로 하루에 24개로 계산
  const keysFromShop = (honorCount + guildCount) * 60 * weeks; // 명예 & 길드 상점
  const keysFromWeekend = 200 * weeks; // 주말 푸시 열쇠 (토,일 100개씩)
  const keysFromKeyBox = ((1 + 
    (keyBoxRuby >= 50 ? 20 : 0) +
    (keyBoxRuby >= 80 ? 50 : 0) +
    (keyBoxRuby >= 100 ? 50 : 0) +
    (keyBoxRuby >= 120 ? 50 : 0)) * 60) * days;

  const totalKeysBeforeRaid = totalNaturalKeys + keySubKeys + keysFromSenaPass +
    keysFromDailySources + keysFrom300Attendance + keysFromShop + keysFromWeekend + keysFromKeyBox;

  // 🔹 레이드 차감
  const raidKeysUsed = raidCountPerDay * 6 * days; // 레이드에 사용되는 열쇠 수
  const keysForCholjak = totalKeysBeforeRaid - raidKeysUsed; // 레이드 열쇠 차감 후 쫄작용 열쇠
  // 레이드 열쇠 소모량이 총 열쇠보다 많을 경우 → 경고 출력
  const raidWarning = document.getElementById("raidWarning");
    if (keysForCholjak < 0) {
      raidWarning.style.display = "inline";
      // return {
      //   netProfit: 0,
      //   heroCount: 0
      // }; // 계산 중단
    } else {
      raidWarning.style.display = "none";
    }

  // 🔹 정확한 쫄작원정대 루프 계산 방식 적용
  const externalRuns = keysForCholjak / 6; // 쫄작원정대 열쇠 이외 열쇠로 쫄작돌리는 횟수
  let totalCholjakKeys = keysForCholjak;
    if (includeExpeditionKey) {
      const choljakQuestKeys = (externalRuns / 2115) * 270;
      totalCholjakKeys += choljakQuestKeys;

      console.log("원정대 열쇠 보상:", choljakQuestKeys);
    } else {
      console.log("원정대 열쇠 포함하지 않음");
    }

  // 🔹 쫄작 루비 수익
  const keysPerRun = rubySub ? 60 : 66;
  const runs = totalCholjakKeys / keysPerRun;
  const heroCount = runs * 4;
  const rubyFromCholjak = runs * 80;

  // 🔹 기타 루비 수급
  const rubyFromRubySub = rubySub ? (days * 200 + (period === 2 ? 165 : 330)) : 0;
  const rubyFromKeySubBonus = keySub ? (period === 2 ? 100 : 200) : 0;
  const rubyFromSenaPass = senaPass ? 2900 : 500; // (period === 2 ? 1450 : 2900) : (period === 2 ? 250 : 500);
  const rubyFromDailyQuest = 100 * days;
  const rubyFrom300Attendance = 20 * days; // 300일 출석표 루비. 10일에 200개 이므로 하루에 20개로 계산
  const rubyFromFreeShop = 30 * days;
  const rubyFromWeekend = 100 * weeks;
  const rubyFromConquest = getConquestRuby(conquestTier, weeks);

  const totalRubyIncome = rubyFromCholjak + rubyFromRubySub + rubyFromKeySubBonus +
    rubyFromSenaPass + rubyFromDailyQuest + rubyFrom300Attendance + rubyFromFreeShop + rubyFromWeekend + rubyFromConquest;

  // 🔹 루비 지출
  const rubySpentPerDay = getKeyBoxRubyCostPerDay(keyBoxRuby);
  const rubySpent = rubySpentPerDay * days;

  const netProfit = totalRubyIncome - rubySpent;

  console.log("레이드 차감 전 열쇠:", totalKeysBeforeRaid);
  console.log("자연회복 열쇠:", totalNaturalKeys);
  console.log("월정액 열쇠:", keySubKeys);
  console.log("세나패스 열쇠:", keysFromSenaPass);
  console.log("일일의뢰 & 길드출석:", keysFromDailySources);
  console.log("300일 출석표 열쇠:", keysFrom300Attendance);
  console.log("상점 열쇠:", keysFromShop);
  console.log("쫄작 열쇠:", keysForCholjak);
console.log("쫄작 횟수:", runs);
console.log("2주 동안 사용되는 쫄:", heroCount);

  if(keysForCholjak<0){
    return {
      netProfit,
      heroCount:0
    };
  } else{
      return {
        netProfit,
        heroCount
      };
    }
}

  const result4w = compute(4);
  const result2w = compute(2);

  document.getElementById("profit2w").innerText = Math.floor(result2w.netProfit).toLocaleString();
  document.getElementById("profit4w").innerText = Math.floor(result4w.netProfit).toLocaleString();
  document.getElementById("avgProfit").innerText = Math.floor(result2w.netProfit / 14).toLocaleString();
  document.getElementById("heroCount").innerText = Math.floor(result2w.heroCount).toLocaleString();
  const avgHero = result2w.heroCount / 14;
  document.getElementById("avgHeroCount").innerText =
    (avgHero % 1 < 0.05 || avgHero % 1 > 0.95)
      ? Math.round(avgHero).toString()
      : avgHero.toFixed(1);
}

// 전제조건 안내 토글
const overlay = document.getElementById("assumptionOverlay");
const openBtn = document.getElementById("showAssumption");
const closeBtn = overlay.querySelector(".close-btn");

openBtn.addEventListener("click", () => {
  overlay.classList.add("show");
});

closeBtn.addEventListener("click", () => {
  overlay.classList.remove("show");
});

// 바깥 영역 클릭 시 닫기
overlay.addEventListener("click", (e) => {
  if (e.target === overlay) {
    overlay.classList.remove("show");
  }
});

const includedItemsOverlay = document.getElementById("includedItemsOverlay");
  const showIncludedItemsBtn = document.getElementById("showIncludedItems");

  showIncludedItemsBtn.addEventListener("click", () => {
    includedItemsOverlay.classList.add("show");
  });

  function closeIncludedItems() {
    includedItemsOverlay.classList.remove("show");
  }

  includedItemsOverlay.addEventListener("click", (e) => {
    if (e.target === includedItemsOverlay) {
      includedItemsOverlay.classList.remove("show");
    }
  });

  // 숫자 입력이 8 이상이면 자동으로 7로 변경
function enforceMaxValue(id, max) {
  const input = document.getElementById(id);
  input.addEventListener('input', () => {
    let val = parseInt(input.value);
    if (val > max) {
      input.value = max;
    }
  });
}

// 적용 대상 input 요소 등록
enforceMaxValue("honorKeyCount", 7);
enforceMaxValue("guildKeyCount", 7);
</script>
</body>
</html>
